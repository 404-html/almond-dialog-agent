<html>
<head>
    <title>Pick the right rule</title>
</head>

<script>
/*
My plan is to put 2 query parameters in the url since we know the devices used in each sentence.
As a result, turkers don't need to select device.

So the link should look like: "...makerule.html?device1=twitter&device2=facebook"
*/
function getParamByName(name) {
    var url = window.location.href;
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
    results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
    
}
var device1 = getParamByName("device1");
var device2 = getParamByName("device2");

const BASE_URL = 'https://thingengine.stanford.edu/thingpedia/api/examples?';
function getExamplesByName(name) {
    var to = BASE_URL + 'key=' + encodeURIComponent(name);
    var examples = JSON.parse(_simpleRequest(to));
    var filtered = [];
    var added = new Set();
    for (var ex of examples) {
        if (ex.target_json.indexOf("\"slots\":\[") < 0)
            continue;
        if (added.has(ex.target_json))
            continue;
        added.add(ex.target_json);
        filtered.push(ex);
    }
    return filtered;
}

function _simpleRequest(to) {
    var xmlHttp = new window.XMLHttpRequest();
    xmlHttp.open("GET", to, false);
    xmlHttp.send(null);
    return xmlHttp.responseText;
}

function listCommands(cmds) {
    for (var cmd of cmds) {
        document.write(cmd.utterance + "<br />");
    }
}
var cmd1 = getExamplesByName(device1);
var cmd2 = getExamplesByName(device2);

</script>

<body>
    <div class="body">
        <h1 class="title">
        Pick the right rule given the sentence
        <h1>
    </div>
    <p>
    Given the sentence you were given on the HIT, try use the following tool to build it.
    </p>

<h4><script>document.write(device1);</script></h4>
<p> <script>listCommands(cmd1)</script></p>

<h4><script>document.write(device2);</script></h4>
<p> <script>listCommands(cmd2)</script></p>


<p>

</body>
</html>
